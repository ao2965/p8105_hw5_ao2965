---
title: "p8105_hw5_ao2965"
author: "Alissa Shams Orchi"
date: "2025-11-14"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(broom)

theme_set(theme_minimal())
```

# Problem 2


```{r run-simulations, cache=TRUE}
n = 30
sigma = 5
alpha = 0.05
n_sim = 5000

# Simulation function
sim_t_test = function(mu, n = 30, sigma = 5) {
  sim_data = rnorm(n, mean = mu, sd = sigma)
  test = t.test(sim_data, mu = 0)
  broom::tidy(test) |> 
    select(estimate, p.value)
}

sim_mu_0 = map_dfr(1:n_sim, ~ sim_t_test(mu = 0)) |> 
  mutate(mu_true = 0)

sim_mu_1 = map_dfr(1:n_sim, ~ sim_t_test(mu = 1)) |> 
  mutate(mu_true = 1)

sim_mu_2 = map_dfr(1:n_sim, ~ sim_t_test(mu = 2)) |> 
  mutate(mu_true = 2)

sim_mu_3 = map_dfr(1:n_sim, ~ sim_t_test(mu = 3)) |> 
  mutate(mu_true = 3)

sim_mu_4 = map_dfr(1:n_sim, ~ sim_t_test(mu = 4)) |> 
  mutate(mu_true = 4)

sim_mu_5 = map_dfr(1:n_sim, ~ sim_t_test(mu = 5)) |> 
  mutate(mu_true = 5)

sim_mu_6 = map_dfr(1:n_sim, ~ sim_t_test(mu = 6)) |> 
  mutate(mu_true = 6)

sim_results = bind_rows(
  sim_mu_0,
  sim_mu_1,
  sim_mu_2,
  sim_mu_3,
  sim_mu_4,
  sim_mu_5,
  sim_mu_6
)

```

```{r }
power_summary = sim_results |> 
  group_by(mu_true) |> 
  summarize(
    power = mean(p.value < 0.05),
    avg_estimate_all = mean(estimate),
    avg_estimate_rejected = mean(estimate[p.value < 0.05]),
    n_simulations = n()
  )

power_summary
```
```{r}
power_plot = power_summary |> 
  ggplot(aes(x = mu_true, y = power)) +
  geom_point(size = 3) +
  geom_line() +
  scale_y_continuous(limits = c(0, 1)) +
  labs(
    title = "Power vs Effect Size",
    x = "True value of μ",
    y = "Power (Proportion of times null was rejected)"
  ) +
  theme_minimal()

power_plot
```

As effect size increases power incrrwase in the plot. after reaching 4 it plateaus


`````{r estimates-plot-faceted}
estimates_plot = power_summary |> 
  select(mu_true, avg_estimate_all, avg_estimate_rejected) |> 
  pivot_longer(
    cols = starts_with("avg"),
    names_to = "sample_type",
    values_to = "average_estimate"
  ) |> 
  mutate(
    sample_type = case_when(
      sample_type == "avg_estimate_all" ~ "All samples",
      sample_type == "avg_estimate_rejected" ~ "Rejected null only"
    )
  ) |> 
  ggplot(aes(x = mu_true, y = average_estimate)) +
  geom_point(size = 3, color = "blue") +
  geom_line(color = "blue") +
  facet_wrap(~ sample_type, ncol = 2) +  
  labs(
    title = "Average Estimate of μ̂ by True μ",
    x = "True value of μ",
    y = "Average estimate of μ̂"
  ) +
  geom_abline(slope = 1, intercept = 0,   
            linetype = "dashed", alpha = 0.5) +
  theme_minimal()

estimates_plot
`````


* The sample average of μ̂ across tests where the null was rejected is NOT approximately 
equal to the true μ, especially for small effect sizes.  This occurs because when the true effect is small, we only reject the null when random variation produces unusually large estimates. This selection bias disappears 
as power increases because nearly all samples lead to rejection.

# Problem 3

### Raw data
```{r, message=FALSE}
homicide_data = read_csv("homicide-data.csv")

n_obs = nrow(homicide_data)
n_vars = ncol(homicide_data)
var_names = names(homicide_data) |> str_c(collapse = ", ")
```

* The Washington Post homicide dataset contains `r format(n_obs, big.mark = ",")` observations 
and `r n_vars` variables. The variables included are: `r var_names`.

### Create city_state variable and summarize

```{r}
homicide_summary = homicide_data |> 
  mutate(
    city_state = str_c(city, ", ", state),
    city_state = str_replace(city_state, "Milwaukee, wI", "Milwaukee, WI"),
    resolution = case_when(
      disposition == "Closed without arrest" ~ "unsolved",
      disposition == "Open/No arrest" ~ "unsolved", 
      disposition == "Closed by arrest" ~ "solved"
    )
  ) |> 
  filter(city_state != "Tulsa, AL") |> 
  group_by(city_state) |> 
  summarize(
    total_homicides = n(),
    unsolved_homicides = sum(resolution == "unsolved"),
    .groups = "drop"
  )

homicide_summary |> 
  arrange(desc(total_homicides))

homicide_summary |> 
  arrange(desc(unsolved_homicides))
```
* After summarizing the total number of homicides, we see that the 5 cities with the highest number of total homicides are Chicago, Philadelphia, Houston, Baltimore, Detroit.

* After summarizing the total number of unsolved_homicides, we see that the 5 cities with the highest number of total unsolved_homicides are Chicago, Baltimore, Houston, Detroit, Philadelphia.